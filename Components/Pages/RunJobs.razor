@page "/"
@using EasyPolicheck.Data;
@using System.Text.Json;
@using System.Linq;
@using CommunityToolkit.Maui.Storage;
@inject JobsService JobsService
@inject PolicheckService PolicheckService


<div>
    @runStatus
    <button class="btn btn-primary">Browse</button>
</div>


@code {

    public string? runStatus = "Verifying Policheck location";
    public string? poliInstall = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory) +
    @"\policheck\tools\Policheck.exe";
    List<JobInfo> JobsInfo = new List<JobInfo>();
    List<PolicheckLocation> LocationInfo = new List<PolicheckLocation>();

    protected override void OnInitialized()
    {
        
        var jobs = JobsService.LoadJobs();
        JobsInfo.AddRange(jobs);

        var pcLocation = PolicheckService.LoadLocation();
        LocationInfo.AddRange(pcLocation);
        
        @* bool found = File.Exists(poliInstall); *@
        if (File.Exists(poliInstall))
        {
            runStatus = "Policheck located and ready to run.";
        }

        Console.WriteLine(poliInstall);

    }

    private async void browseFolder(bool temp)
    {
        var folder = await FolderPicker.PickAsync(default);
        if (folder.IsSuccessful)
        {
            //do something
        }
        else
        {
            //do something later
        }
    }
}

@* protected override void OnAfterRender(bool firstRender)
{

if (firstRender)
{
string poliInstall = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory) +
@"\policheck\tools\policheck.exe";
bool found = File.Exists(poliInstall);

if (File.Exists(poliInstall))
{
Console.WriteLine("File exists");
}
else
{
Console.WriteLine("Can't find");
}
firstRender = false;

}
else
{
Console.WriteLine("Not first render");
}
} *@
